{% extends "base.html" %}

{% block title %}{% if material %}Edit{% else %}New{% endif %} Material - Ethera Jewelry{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1>{% if material %}Edit{% else %}New{% endif %} Material</h1>
    </div>
    <a href="/materials" class="btn btn-secondary">Cancel</a>
</div>

<form method="POST" action="{% if material %}/api/materials/{{ material.id }}{% else %}/api/materials/{% endif %}" style="max-width: 600px;">
    <div class="form-group">
        <label for="type">Type *</label>
        <select name="type" id="type" required>
            <option value="">Select type...</option>
            <option value="GEMSTONE" {% if material and material.type.value == 'GEMSTONE' %}selected{% endif %}>Gemstone</option>
            <option value="METAL" {% if material and material.type.value == 'METAL' %}selected{% endif %}>Metal</option>
            <option value="OTHER" {% if material and material.type.value == 'OTHER' %}selected{% endif %}>Other</option>
        </select>
    </div>
    
    <div class="form-group">
        <label for="name">Name *</label>
        <input type="text" name="name" id="name" value="{% if material %}{{ material.name }}{% endif %}" required>
    </div>
    
    <div class="form-group">
        <label for="unit">Unit *</label>
        <input type="text" name="unit" id="unit" value="{% if material %}{{ material.unit }}{% endif %}" placeholder="ct, gram, piece, etc." required>
    </div>
    
    <div class="form-group">
        <label for="notes">Notes</label>
        <textarea name="notes" id="notes">{% if material %}{{ material.notes or '' }}{% endif %}</textarea>
    </div>
    
    <div class="actions">
        <button type="submit" class="btn">{% if material %}Update{% else %}Create{% endif %} Material</button>
    </div>
</form>

<script>
document.querySelector('form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    const data = Object.fromEntries(formData);
    
    const url = e.target.action;
    const method = '{% if material %}PUT{% else %}POST{% endif %}';
    
    try {
        const response = await fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        if (response.ok) {
            window.location.href = '/materials';
        } else {
            alert('Error saving material');
        }
    } catch (error) {
        alert('Error saving material: ' + error.message);
    }
});
</script>
{% endblock %}
